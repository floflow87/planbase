Voici le prompt isol√©, pr√™t √† √™tre copi√©-coll√© tel quel üëá

‚∏ª

üéØ PROMPT REPLIT ‚Äî TEST PACK OPTIMISTIC UPDATES (VITEST + PLAYWRIGHT)

Tu es l‚Äôagent Replit charg√© de v√©rifier, s√©curiser et valider les optimistic updates r√©cemment impl√©ment√©es dans PlanBase.

Objectif : garantir que l‚ÄôUI est instantan√©e, que les rollbacks fonctionnent correctement en cas d‚Äôerreur, et que les donn√©es restent coh√©rentes entre toutes les vues.

‚∏ª

1Ô∏è‚É£ Strat√©gie de tests √† 2 niveaux

Niveau A ‚Äî Tests unitaires (Vitest)

Cr√©er ou compl√©ter des tests unitaires pour les hooks de mutation et utilitaires li√©s aux optimistic updates :
	‚Ä¢	V√©rifier que les queryKey sont correctement utilis√©es et coh√©rentes
	‚Ä¢	V√©rifier que setQueryData applique imm√©diatement les changements attendus
	‚Ä¢	V√©rifier que les snapshots d‚Äô√©tat pr√©c√©dent sont bien restaur√©s en cas d‚Äôerreur
	‚Ä¢	V√©rifier que invalidateQueries est appel√© sur les bonnes cl√©s en onSettled

‚∏ª

Niveau B ‚Äî Tests E2E (Playwright) ‚Äî Priorit√©

Mettre en place (ou compl√©ter) Playwright avec un pack minimal de sc√©narios couvrant les flux critiques.

Sc√©nario 1 ‚Äî Notes : cr√©ation optimiste
	‚Ä¢	Cr√©er une note
	‚Ä¢	V√©rifier apparition imm√©diate dans la liste
	‚Ä¢	Recharger la page
	‚Ä¢	V√©rifier que la note persiste

Sc√©nario 2 ‚Äî Notes : √©dition optimiste
	‚Ä¢	Modifier le titre d‚Äôune note
	‚Ä¢	V√©rifier mise √† jour imm√©diate (vue d√©tail + liste)
	‚Ä¢	Recharger la page
	‚Ä¢	V√©rifier coh√©rence

Sc√©nario 3 ‚Äî Notes : suppression optimiste
	‚Ä¢	Supprimer une note
	‚Ä¢	V√©rifier disparition imm√©diate de la liste
	‚Ä¢	Recharger la page
	‚Ä¢	V√©rifier suppression persistante

Sc√©nario 4 ‚Äî Rollback sur erreur API
	‚Ä¢	Simuler une erreur serveur (500 ou offline) sur une mutation
	‚Ä¢	V√©rifier :
	‚Ä¢	rollback visuel imm√©diat
	‚Ä¢	message d‚Äôerreur/toast affich√©
	‚Ä¢	aucune donn√©e incoh√©rente restante

Sc√©nario 5 ‚Äî Coh√©rence multi-vues
	‚Ä¢	Cr√©er ou modifier une t√¢che li√©e √† un projet
	‚Ä¢	V√©rifier :
	‚Ä¢	mise √† jour imm√©diate dans la liste des t√¢ches
	‚Ä¢	mise √† jour des compteurs / KPIs du projet
	‚Ä¢	coh√©rence dans le backlog (si applicable)
	‚Ä¢	aucun refresh manuel requis

‚∏ª

2Ô∏è‚É£ Simulation des erreurs

Mettre en place au moins une des m√©thodes suivantes :
	‚Ä¢	Interception r√©seau Playwright pour forcer une r√©ponse 500 sur une mutation
	‚Ä¢	Mode dev ?failMutation=1 (uniquement en d√©veloppement) for√ßant un √©chec API
	‚Ä¢	Simulation du mode offline dans Playwright pendant une mutation

‚∏ª

3Ô∏è‚É£ Scripts de test

Ajouter ou v√©rifier la pr√©sence des scripts suivants :
	‚Ä¢	npm run test ‚Üí ex√©cute Vitest
	‚Ä¢	npm run test:e2e ‚Üí ex√©cute Playwright
	‚Ä¢	npm run test:e2e:ui ‚Üí Playwright en mode interactif

‚∏ª

4Ô∏è‚É£ Corrections attendues si √©chec

Si un test √©choue, corriger :
	‚Ä¢	les invalidations de queries manquantes ou incorrectes
	‚Ä¢	les optimistic updates √©crasant des champs non concern√©s
	‚Ä¢	les divergences de queryKey entre vues liste / d√©tail / KPI

‚∏ª

5Ô∏è‚É£ Crit√®res d‚Äôacceptation

La t√¢che est valid√©e si :
	‚Ä¢	Tous les tests passent
	‚Ä¢	Les mutations sont per√ßues comme instantan√©es par l‚Äôutilisateur
	‚Ä¢	Les rollbacks sont syst√©matiques, visibles et propres
	‚Ä¢	Aucune divergence de donn√©es entre les vues
	‚Ä¢	Aucun refresh manuel n‚Äôest n√©cessaire pour voir les changements

‚∏ª

Intention produit :
L‚Äôapplication doit toujours donner une sensation de r√©activit√© imm√©diate, tout en restant fiable et coh√©rente, m√™me en cas d‚Äôerreur r√©seau ou serveur.