OK, je vois trÃ¨s bien le pattern sur tes captures : câ€™est un problÃ¨me de â€œdouble offset safe-areaâ€ + header pas vraiment sticky/fixed partout + layout des toasts sur mobile. On va corriger Ã§a dâ€™un coup, propre, scalable, sans rustines page par page.

Voici le prompt isolÃ© pour Replit (il couvre les 3 sujets).

â¸»

ğŸ¯ PROMPT REPLIT â€” iOS PWA: Gap safe-area/topbar + Header non fixed + Toasts tronquÃ©s

Tu es lâ€™agent Replit. Sur iOS PWA, la safe area violette est revenue âœ… mais :
	1.	Il y a un espace (gap) entre la safe-area violette et la topbar blanche.
Quand jâ€™ouvre le menu avatar, la topbar se repositionne correctement puis revient au bug â†’ signe dâ€™un double calcul de padding / top offset ou dâ€™un layout qui recalcule au focus.
	2.	Le menu topbar (header) nâ€™est pas â€œfix/stickyâ€ sur certaines pages : mindmaps / marketing / documents.
	3.	Les toasts de succÃ¨s (fond vert) sont tronquÃ©s sur mobile.

Objectif : corriger durablement au niveau du layout/design-system, pas en patchant chaque page.

â¸»

A) Fix gap safe-area / topbar (cause: double safe-area + header top)

1) Audit du layout global

Identifier oÃ¹ env(safe-area-inset-top) est appliquÃ© :
	â€¢	SafeAreaTopBar (height = safe-area)
	â€¢	padding-top sur le root container
	â€¢	topbar/header en top: env(safe-area-inset-top) ou similaire
Le bug vient quasi sÃ»rement dâ€™un safe-area appliquÃ© 2 fois.

2) Choisir UNE stratÃ©gie unique (et la rendre canonique)

âœ… StratÃ©gie recommandÃ©e (la plus stable) :
	â€¢	SafeAreaTopBar dessine la zone violette (height = safe-area)
	â€¢	La topbar (header) est positionnÃ©e juste dessous, via top: env(safe-area-inset-top) si fixed
	â€¢	Le reste du contenu commence sous la topbar (padding-top classique), sans re-ajouter la safe-area.

Donc :
	â€¢	supprimer tout padding-top: env(safe-area-inset-top) sur des wrappers si dÃ©jÃ  gÃ©rÃ© par header fixed.
	â€¢	ou Ã  lâ€™inverse : si on garde padding-top root, alors header DOIT Ãªtre top: 0 (pas safe-area).

â¡ï¸ ImplÃ©menter un helper unique :
client/src/utils/layoutOffsets.ts
	â€¢	getSafeAreaTop() (CSS variable)
	â€¢	isStandalone()

Et dÃ©finir une CSS variable globale sur :root quand standalone mobile :
	â€¢	--safe-top: env(safe-area-inset-top)
	â€¢	--header-h: <hauteur header> (ex: 56px)
Puis utiliser ces variables partout.

3) Rendre le comportement stable (Ã©viter le â€œÃ§a se replace puis revientâ€)

Ce symptÃ´me arrive quand :
	â€¢	le menu ouvre un portal/focus qui dÃ©clenche un reflow
	â€¢	un container passe de position: static Ã  relative ou change de hauteur
	â€¢	ou le header dÃ©pend dâ€™un calcul JS instable

â¡ï¸ Solution :
	â€¢	Topbar doit Ãªtre position: sticky ou fixed de maniÃ¨re constante (pas conditionnelle).
	â€¢	Ne pas recalculer top offset en JS sur open menu.
	â€¢	Utiliser uniquement CSS variables.

â¸»

B) Header non fixed sur Mindmaps/Marketing/Documents

1) ProblÃ¨me

Certaines pages nâ€™utilisent pas le mÃªme â€œAppShellâ€ que les autres, ou ont un wrapper scroll diffÃ©rent.

2) Correction
	â€¢	CrÃ©er/renforcer un composant unique AppShell (si pas dÃ©jÃ ) :
	â€¢	<Header /> commun
	â€¢	<Main /> avec scroll interne (recommended) : overflow-y-auto; height: 100dvh;
	â€¢	Toutes les pages doivent Ãªtre rendues Ã  lâ€™intÃ©rieur de ce shell, sans wrapper qui casse sticky.

3) Choix technique recommandÃ©

Utiliser position: sticky pour le header (plutÃ´t que fixed) SI scroll est sur body.
Sinon, si scroll est dans <Main />, sticky doit sâ€™appliquer dans ce conteneur.

â¡ï¸ Standardiser :
	â€¢	Le scroll doit Ãªtre toujours au mÃªme endroit (body OU main).
	â€¢	Ensuite sticky fonctionnera partout.

â¸»

C) Toasts de succÃ¨s tronquÃ©s (mobile)

1) Cause probable
	â€¢	largeur max trop petite
	â€¢	overflow-hidden sur container
	â€¢	ou toast fixÃ© trop haut/bas avec safe-area
	â€¢	ou texte en whitespace-nowrap

2) Correctif DS Toast

Dans le composant toast (shadcn Toaster / ToastViewport / Toast):
	â€¢	autoriser le wrapping :
	â€¢	whitespace-normal
	â€¢	break-words
	â€¢	padding et max-width mobile :
	â€¢	w-[calc(100vw-24px)] max-w-[420px]
	â€¢	position safe-area aware :
	â€¢	si en bas : bottom: calc(env(safe-area-inset-bottom) + 12px)
	â€¢	si en haut : top: calc(env(safe-area-inset-top) + 12px)
	â€¢	sâ€™assurer quâ€™aucun parent nâ€™a overflow: hidden qui coupe les toasts.

3) VÃ©rifier sur iOS PWA
	â€¢	toast succÃ¨s long (phrase > 80 caractÃ¨res)
	â€¢	doit Ãªtre lisible, non tronquÃ©, et non masquÃ© par header/safe-area.

â¸»

CritÃ¨res dâ€™acceptation
	1.	En iOS PWA : aucun gap entre safe-area violette et topbar.
	2.	Le header/topbar reste correctement positionnÃ© en permanence (y compris ouverture menu avatar).
	3.	Le header est sticky/fixed sur toutes les pages (mindmaps/marketing/documents inclus).
	4.	Toasts succÃ¨s non tronquÃ©s : texte wrap + viewport safe-area aware.
	5.	Aucun patch page-specific : corrections centralisÃ©es (AppShell + DS Toast + variables layout).

â¸»

Si tu veux, aprÃ¨s Ã§a on fait un mini polish :
	â€¢	ajouter un â€œshadow subtilâ€ sous la topbar quand on scroll, faÃ§on Notion (trÃ¨s premium).