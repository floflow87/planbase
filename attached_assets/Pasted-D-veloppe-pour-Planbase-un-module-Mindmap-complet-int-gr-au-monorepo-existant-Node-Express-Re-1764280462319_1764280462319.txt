DÃ©veloppe pour Planbase un module Mindmap complet, intÃ©grÃ© au monorepo existant (Node + Express + React + Supabase), conforme Ã  lâ€™architecture actuelle (backend et frontend unifiÃ©s, Supabase en multi-tenant avec RLS).

Je dÃ©cris ci-dessous lâ€™ensemble des spÃ©cifications fonctionnelles, techniques, UI, modÃ¨les de donnÃ©es, interactions, templates et comportements attendus.

Merci dâ€™implÃ©menter ce module de A â†’ Z.

â­ï¸ Objectif global

CrÃ©er un module Mindmap avancÃ© utilisÃ© pour :

parcours utilisateur (user flow),

storyboard,

sitemap,

architecture fonctionnelle ou technique,

brainstorming / idÃ©es libres,

liaison entre objets de lâ€™application (notes, projets, documents, clients, tÃ¢ches),

exploration visuelle dâ€™un projet,

crÃ©ation progressive puis rattachement ultÃ©rieur Ã  un client ou un projet.

Le module doit permettre :

crÃ©ation libre dâ€™une mindmap,

gestion de nÅ“uds variÃ©s,

liens en mode draft,

bouton â€œConnecter les nÅ“udsâ€ pour transformer les liens draft en liens mÃ©tier rÃ©els,

rattachement optionnel Ã  un client ou projet,

plusieurs mindmaps par client et par projet,

templates,

plusieurs vues UI (dÃ©pliÃ©e / semi / pliÃ©e),

autocomplete intelligent lors de la crÃ©ation de nÅ“uds.

ğŸ§© 1. ModÃ¨le de donnÃ©es Supabase (multi-tenant + RLS)
Table mindmaps
mindmaps (
  id uuid primary key,
  account_id uuid not null,
  title text not null,
  kind text default 'generic',   -- 'generic' | 'user_journey' | 'storyboard' | 'sitemap' | 'architecture'
  client_id uuid null,
  project_id uuid null,
  layout_config jsonb null,      -- config UI selon le template
  created_by uuid not null,
  created_at timestamptz default now()
)

Table mindmap_nodes
mindmap_nodes (
  id uuid primary key,
  mindmap_id uuid not null references mindmaps(id),
  account_id uuid not null,
  type text not null,            -- 'note' | 'project' | 'document' | 'task' | 'idea' | 'client' | 'generic'
  title text not null,
  description text null,
  image_url text null,           -- pour storyboard / parcours / archi
  linked_entity_type text null,  -- 'note' | 'project' | 'document' | 'task' | 'client'
  linked_entity_id uuid null,
  x float not null,
  y float not null,
  created_at timestamptz default now()
)

Table mindmap_edges
mindmap_edges (
  id uuid primary key,
  mindmap_id uuid not null references mindmaps(id),
  account_id uuid not null,
  source_node_id uuid not null references mindmap_nodes(id),
  target_node_id uuid not null references mindmap_nodes(id),
  is_draft boolean default true,
  linked_entity_link_id uuid null, 
  created_at timestamptz default now()
)

RLS

Toutes les tables doivent Ãªtre protÃ©gÃ©es avec :

account_id = auth.jwt()->>'account_id'

ğŸš€ 2. Backend â€“ API Ã  implÃ©menter (Express)
Mindmaps

POST /api/mindmaps
CrÃ©e une mindmap (pas besoin de client/projet au dÃ©part).

GET /api/mindmaps/:id

PATCH /api/mindmaps/:id
Pour rattacher un client ou projet + mettre Ã  jour layout_config.

DELETE /api/mindmaps/:id

NÅ“uds

POST /api/mindmaps/:id/nodes
CrÃ©er un nÅ“ud (titre, type, position).

PATCH /api/mindmaps/:id/nodes/:nodeId
DÃ©placement, Ã©dition, ajout dâ€™image, changement de type.

DELETE /api/mindmaps/:id/nodes/:nodeId

Edges

POST /api/mindmaps/:id/edges
CrÃ©e un edge en mode is_draft=true.

DELETE /api/mindmaps/:id/edges/:edgeId

POST /api/mindmaps/:id/connect-nodes
â†’ transforme les edges draft en vrais liens mÃ©tier :

crÃ©e des liens dans une table entity_links (Ã  crÃ©er si nÃ©cessaire),

remplit linked_entity_link_id,

passe is_draft=false.

ğŸ¨ 3. UI / Frontend â€“ Comportements attendus

Le module doit Ãªtre construit avec React + React Flow ou Ã©quivalent.

3.1. Canvas Mindmap

Vue pannable + zoomable.

Drag & drop des nÅ“uds.

Drag & drop des liens.

Suppression des liens (visuel et mÃ©tier).

Sidebar pour crÃ©er des nÅ“uds.

3.2. NÅ“uds â€“ types supportÃ©s

Un nÅ“ud peut Ãªtre :

Idea (libre)

Note

Projet

Document

TÃ¢che

Client

Chaque nÅ“ud peut :

afficher un titre,

afficher une description,

afficher / uploader une image,

pointer vers un objet rÃ©el de lâ€™app (linked_entity_type / linked_entity_id).

3.3. CrÃ©ation dâ€™un nÅ“ud avec autocomplete intelligent

Lorsquâ€™on crÃ©e un nÅ“ud :

Champ â€œTitreâ€ + champ â€œTypeâ€

Si le type correspond Ã  un objet existant (ex : Note, Projet, TÃ¢che, Client, Document) â†’
autocomplete qui recherche dans Supabase :

notes

projets

documents

tÃ¢ches

clients

Si lâ€™utilisateur sÃ©lectionne un Ã©lÃ©ment :

le nÅ“ud devient automatiquement liÃ© :

linked_entity_type

linked_entity_id

title = nom de lâ€™entitÃ©

Si pas sÃ©lectionnÃ© â†’ câ€™est un nÅ“ud libre.

3.4. Vues & Templates (important)

Chaque mindmap peut Ãªtre affichÃ©e selon plusieurs vues configurÃ©es par layout_config :

1) Vue DÃ©pliÃ©e (Storyboard)

affiche image + description + titre

nÅ“uds rectangulaires larges

pensÃ©e pour faire un storyboard ou une timeline

2) Vue User Flow (Semi-dÃ©pliÃ©e)

titre obligatoire

description optionnelle

image facultative

idÃ©ale pour parcours utilisateur

3) Vue Architecture

icÃ´nes systÃ¨me / modules

pas dâ€™image

description optionnelle

nÅ“uds compacts

4) Vue IdÃ©es / Brainstorm

bulles arrondies

juste un titre

style Post-it

5) Vue Sitemap (PliÃ©e)

uniquement titre

pas dâ€™image ni description

hierarchie claire

Lâ€™utilisateur peut afficher / masquer :

titre

description

image

tags (futur)

statut (futur)

3.5. Gestion des templates (Ã  la crÃ©ation)

Au moment de crÃ©er une nouvelle mindmap :

Afficher des templates :

â€œPage blancheâ€

â€œParcours utilisateurâ€

â€œStoryboardâ€

â€œSitemapâ€

â€œArchitectureâ€

â€œIdÃ©es / Brainstormâ€

Chaque template doit :

crÃ©er automatiquement les nÅ“uds & edges par dÃ©faut (optionnel)

dÃ©finir un layout_config adaptÃ©

ğŸ”— 4. Mode Draft & Bouton â€œConnecter les nÅ“udsâ€

Toutes les relations crÃ©Ã©es via la mindmap sont dâ€™abord du draft (is_draft=true).

Un bouton global â€œConnecter les nÅ“udsâ€ :

RÃ©cupÃ¨re tous les edges draft

Si les deux nÅ“uds sont liÃ©s Ã  des objets mÃ©tier â†’
crÃ©er une relation dans la table entity_links (Ã  crÃ©er)

Mettre Ã  jour linked_entity_link_id

Passer is_draft=false

Recharger la mindmap

Cela permet une rÃ©flexion libre sans risquer dâ€™impacter le reste de lâ€™app, avant une Ã©tape de validation.

ğŸ§­ 5. Suppression des liens

Lâ€™utilisateur doit pouvoir :

supprimer un edge visuel (draft uniquement)

supprimer un edge rÃ©el (â†’ casser le lien mÃ©tier + supprimer lâ€™edge)

Si un linked_entity_link_id existe â†’ proposer :

â€œSupprimer seulement le lien visuelâ€

â€œSupprimer aussi le lien dans le projetâ€

ğŸ§­ 6. Rattachement client / projet (optionnel)

Une mindmap peut Ãªtre :

libre (pas de client / projet)

rattachÃ©e Ã  un client

rattachÃ©e Ã  un projet (qui lui-mÃªme est rattachÃ© Ã  un client)

Depuis les propriÃ©tÃ©s de la mindmap, permettre :

choisir un client

choisir un projet (filtrÃ© par client)

changement possible Ã  tout moment

Lorsquâ€™on crÃ©e un nÅ“ud liÃ© Ã  un projet ou note existante â†’
la mindmap propose automatiquement de se rattacher si elle ne lâ€™est pas encore.

ğŸ§­ 7. Fonction â€œVoir sur une mindmapâ€ depuis une entitÃ©

Depuis une note, un projet, un client, un document, une tÃ¢che :

Bouton â€œVoir sur une mindmapâ€

Modale :

â€œNouvelle mindmapâ€

â€œChoisir une mindmap existanteâ€

Quand sÃ©lectionnÃ©e :

crÃ©er un nouveau nÅ“ud liÃ© Ã  lâ€™Ã©lÃ©ment (linked_entity_type, linked_entity_id)

positionner au centre de la carte

ouvrir la mindmap

ğŸ¯ 8. Objectif final

Un module Mindmap complet, flexible, multi-usage, qui devient :

la vue visuelle du client,

la vue user flow,

la vue sitemap,

la vue storyboard,

la vue architecture,

la vue idÃ©es,

un outil dâ€™organisation,

un outil de crÃ©ation de lien dans le systÃ¨me.

Il doit Ãªtre pensÃ© proprement, scalable, clair, totalement intÃ©grÃ© Ã  lâ€™architecture Planbase.